<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calcolo Stipendio Netto Multi-Paese - Stima Gratuita</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="tax-systems.js"></script>
    <script src="i18n.js"></script>
    <script src="country-selector.js"></script>
</head>
<body class="bg-gray-50">
    
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <nav class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <a href="index.html" class="flex items-center space-x-2">
                    <i class="fas fa-money-bill-wave text-green-600 text-2xl"></i>
                    <span class="text-xl font-bold text-gray-800">Servizi Business</span>
                </a>
                
                <div class="flex items-center gap-4">
                    <div id="headerCountrySelector"></div>
                    
                    <div class="flex gap-1 border-l pl-4">
                        <button class="lang-btn px-3 py-1 rounded text-sm" data-lang="it">IT</button>
                        <button class="lang-btn px-3 py-1 rounded text-sm" data-lang="en">EN</button>
                        <button class="lang-btn px-3 py-1 rounded text-sm" data-lang="de">DE</button>
                        <button class="lang-btn px-3 py-1 rounded text-sm" data-lang="fr">FR</button>
                        <button class="lang-btn px-3 py-1 rounded text-sm" data-lang="es">ES</button>
                        <button class="lang-btn px-3 py-1 rounded text-sm" data-lang="hu">HU</button>
                    </div>
                    
                    <a href="index.html" class="text-gray-600 hover:text-blue-600 transition">
                        <i class="fas fa-home mr-2"></i><span data-i18n="home">Home</span>
                    </a>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-4 py-12">
        <div class="max-w-5xl mx-auto">
            
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold text-gray-800 mb-4" data-i18n="salaryCalculatorTitle">Calcolo Stipendio Netto</h1>
                <p class="text-xl text-gray-600" data-i18n="salaryCalculatorSubtitle">Scopri quanto guadagnerai al netto</p>
                <div class="mt-4 inline-flex items-center bg-green-50 px-4 py-2 rounded-lg">
                    <i class="fas fa-globe mr-2 text-green-600"></i>
                    <span class="text-green-800 font-semibold" id="currentCountryName"></span>
                </div>
            </div>

            <!-- Calculator Container -->
            <div id="calculatorContainer" class="bg-white rounded-2xl shadow-xl p-8 mb-8">
                
                <div class="grid md:grid-cols-2 gap-6 mb-8">
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2" data-i18n="grossSalaryLabel">Stipendio Lordo Annuo</label>
                        <div class="relative">
                            <span id="currencySymbol" class="absolute left-4 top-4 text-gray-400 text-xl">€</span>
                            <input type="number" id="grossSalary" class="w-full pl-10 pr-4 py-4 text-2xl border-2 border-gray-300 rounded-lg focus:border-green-600 focus:outline-none" placeholder="30000" value="30000">
                        </div>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2" data-i18n="familyDeductions">Detrazioni Familiari</label>
                        <select id="familyStatus" class="w-full px-4 py-4 text-xl border-2 border-gray-300 rounded-lg focus:border-green-600 focus:outline-none appearance-none bg-white">
                            <option value="single" data-i18n="noDeductions">Nessuna (Single)</option>
                            <option value="married" data-i18n="spouseDependent">Coniuge a carico</option>
                        </select>
                    </div>
                </div>

                <div class="grid lg:grid-cols-2 gap-8">
                    
                    <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-6 flex flex-col justify-center">
                        <div class="text-center mb-6">
                            <div class="text-lg text-gray-600 mb-2" data-i18n="netYearlySalary">Stipendio Netto Annuo</div>
                            <div id="netYearly" class="text-5xl font-bold text-green-700">€ 22,500</div>
                        </div>
                        <div class="text-center">
                            <div class="text-base text-gray-600 mb-2" data-i18n="netMonthlySalary">Stipendio Netto Mensile</div>
                            <div id="netMonthly" class="text-3xl font-bold text-green-700">€ 1,875</div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 rounded-xl p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4" data-i18n="deductionsDetail">Dettaglio Trattenute</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center py-2 border-b">
                                <span data-i18n="grossSalaryLabel">Stipendio Lordo</span>
                                <span id="displayGross" class="font-semibold">€ 30,000</span>
                            </div>
                            <div class="flex justify-between items-center py-2 border-b">
                                <span id="socialSecurityLabel">Contributi Sociali</span>
                                <span id="socialSecurityAmount" class="font-semibold text-red-600">- € 2,757</span>
                            </div>
                            <div class="flex justify-between items-center py-2 border-b">
                                <span data-i18n="incomeTax">Imposte</span>
                                <span id="incomeTaxAmount" class="font-semibold text-red-600">- € 6,266</span>
                            </div>
                            <div class="flex justify-between items-center py-2 border-b">
                                <span data-i18n="taxDeductions">Detrazioni Fiscali</span>
                                <span id="deductionsAmount" class="font-semibold text-green-600">+ € 1,564</span>
                            </div>
                            <div class="flex justify-between items-center py-3 mt-4">
                                <span class="text-lg font-bold" data-i18n="totalNetYearly">Totale Netto Annuo</span>
                                <span id="finalNet" class="text-2xl font-bold text-green-700">€ 22,541</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Disclaimer -->
                <div class="mt-6 p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded text-sm text-yellow-800">
                    <i class="fas fa-exclamation-triangle mr-2"></i>
                    <strong>Stima indicativa:</strong> Il calcolo è semplificato e potrebbe non includere tutte le detrazioni, crediti d'imposta o contributi locali specifici. Consulta sempre un commercialista per calcoli esatti.
                </div>
            </div>
        </div>
    </main>

    <style>
        .lang-btn {
            background: #f3f4f6;
            color: #6b7280;
            transition: all 0.2s;
        }
        .lang-btn.active {
            background: #3b82f6;
            color: white;
        }
    </style>

    <script>
        let currentCountryCode = 'it';

        const elements = {
            currentCountryName: document.getElementById('currentCountryName'),
            calculatorContainer: document.getElementById('calculatorContainer'),
            grossSalary: document.getElementById('grossSalary'),
            currencySymbol: document.getElementById('currencySymbol'),
            familyStatus: document.getElementById('familyStatus'),
            netYearly: document.getElementById('netYearly'),
            netMonthly: document.getElementById('netMonthly'),
            displayGross: document.getElementById('displayGross'),
            socialSecurityAmount: document.getElementById('socialSecurityAmount'),
            incomeTaxAmount: document.getElementById('incomeTaxAmount'),
            deductionsAmount: document.getElementById('deductionsAmount'),
            finalNet: document.getElementById('finalNet'),
            socialSecurityLabel: document.getElementById('socialSecurityLabel')
        };

        document.addEventListener('DOMContentLoaded', function() {
            init();
            setupLanguageButtons();
        });

        function init() {
            currentCountryCode = getCurrentCountry();
            applyLocalizationAndUI(currentCountryCode);
            addEventListeners();
        }
        
        function applyLocalizationAndUI(countryCode) {
            currentCountryCode = countryCode;
            const taxSystem = TAX_SYSTEMS[countryCode];
            if (!taxSystem) return;

            elements.currentCountryName.textContent = taxSystem.country;
            elements.currencySymbol.textContent = taxSystem.currencySymbol;
            
            // Aggiorna label contributi in base al paese
            const ssLabels = {
                it: 'Contributi INPS',
                de: 'Sozialversicherung',
                fr: 'Cotisations Sociales',
                es: 'Seguridad Social',
                gb: 'National Insurance',
                us: 'FICA',
                au: 'Superannuation'
            };
            elements.socialSecurityLabel.textContent = ssLabels[countryCode] || 'Social Security';
            
            calculateSalaryForCountry();
        }

        function calculateSalaryForCountry() {
            const gross = parseFloat(elements.grossSalary.value) || 0;
            const familyStatus = elements.familyStatus.value;
            
            const result = calculateSalary(gross, familyStatus, currentCountryCode);
            
            if (!result) {
                alert('Calcolo stipendio non disponibile per questo paese');
                return;
            }
            
            const taxSystem = TAX_SYSTEMS[currentCountryCode];
            const format = (val) => formatCurrency(val, taxSystem);
            
            elements.displayGross.textContent = format(result.gross);
            elements.socialSecurityAmount.textContent = `- ${format(result.socialSecurity)}`;
            elements.incomeTaxAmount.textContent = `- ${format(result.tax)}`;
            elements.deductionsAmount.textContent = result.deductions > 0 ? `+ ${format(result.deductions)}` : format(0);
            elements.finalNet.textContent = format(result.net);
            elements.netYearly.textContent = format(result.net);
            elements.netMonthly.textContent = format(result.monthly);
        }

        function formatCurrency(value, taxSystem) {
            const formattedValue = Math.round(value).toLocaleString('it-IT');
            return taxSystem.currencyPosition === 'before'
                ? `${taxSystem.currencySymbol} ${formattedValue}`
                : `${formattedValue} ${taxSystem.currencySymbol}`;
        }

        function addEventListeners() {
            elements.grossSalary.addEventListener('input', calculateSalaryForCountry);
            elements.familyStatus.addEventListener('change', calculateSalaryForCountry);
            
            window.addEventListener('countryChanged', (e) => {
                applyLocalizationAndUI(e.detail.country);
            });
        }

        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    setLanguage(this.dataset.lang);
                });
            });
        }
    </script>
</body>
</html>